<!DOCTYPE html>
<html lang="en">
<head>
    <title>Evolutionary Algorithm for Webdesign</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="js/fitness.js" type="text/javascript"></script>
    <script src="js/ea.js" type="text/javascript"></script>
    <script src="js/constructor.js" type="text/javascript"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <script type="text/javascript">
        function parse() {
            const select_random = document.querySelector('#random')
            const select_category = document.querySelector('#category')
            const select_selection = document.querySelector('#selection')
            const select_refresh = document.querySelector('#refresh')
            const select_crossover = document.querySelector('#crossover')
            const select_mutation = document.querySelector('#mutation')
            const range_population = document.querySelector('#pop')
            const range_generations = document.querySelector('#gen')

            let duration = []
            let fitness = []
            let output = []

            //1000 iterations to test the algorithm
            for (let i = 0; i < 100; i++) {
                const start = performance.now()
                //Chrom-Generation
                output = EA.run(range_population.value, 18, select_category.value, range_generations.value, select_refresh.value, select_random.value, select_selection.value, select_crossover.value, select_mutation.value)
                const time = performance.now()
                fitness.push(Test.fitness(output, select_category.value))
                duration.push(time - start)
            }

            //Result
            const elements = document.getElementsByClassName('test')
            for (let i = 0; i < elements.length; i++) {
                Constructor.do(elements[i], output)
            }

            //Plots
            plot(fitness, 20, "plot_fitness", "Fitness")
            plot(duration, 10, "plot_duration", "Runtime")

            //AVG Badges
            const fitLabel = document.querySelector("#fitLabel")
            fitLabel.textContent = calculateAverage(fitness)
            const durLabel = document.querySelector("#durLabel")
            durLabel.textContent = calculateAverage(duration)
        }

        function calculateAverage(array) {
            let total = 0;
            let count = 0;

            array.forEach(function(item) {
                total += item;
                count++;
            });
            return total / count;
        }

        function plot(array, range, location, title){
            const xArray = []
            const yArray = array

            for (let i = 0; i < array.length; i++) {
                xArray.push(i)
            }

            // Define Data
            const data = [{
                x:xArray,
                y:yArray,
                mode:"scatter"
            }];

            // Define Layout
            const layout = {
                xaxis: {autorange: true, title: "Iterations"},
                yaxis: {autorange: true},
                title: title
            };
            Plotly.newPlot(location, data, layout);
        }

        window.addEventListener("load", () => {
            const valueRandom = document.querySelector("#randomLabel")
            const inputRandom = document.querySelector("#random")
            valueRandom.textContent = inputRandom.value
            inputRandom.addEventListener("input", (event) => {
                valueRandom.textContent = event.target.value
            })
            const valuePop = document.querySelector("#popLabel")
            const inputPop = document.querySelector("#pop")
            valuePop.textContent = inputPop.value
            inputPop.addEventListener("input", (event) => {
                valuePop.textContent = event.target.value
            })
            const valueGen = document.querySelector("#genLabel")
            const inputGen = document.querySelector("#gen")
            valueGen.textContent = inputGen.value
            inputGen.addEventListener("input", (event) => {
                valueGen.textContent = event.target.value
            })
        });
    </script>
</head>
<body>
    <section class="container p-3">
        <h2 class="display-1 mb-3">Evolutionary Algorithm for Webdesign</h2>
        <section class="row">
            <article class="col-12 col-lg-6 ps-lg-0">
                <form class="border border-1 p-2 p-lg-4 mb-3">
                    <section class="mb-3">
                        <label class="mb-2" for="category">Select a category (Difficulty in ascending order)</label>
                        <select class="form-control" id="category">
                            <option value="b2c">Business to Customer</option>
                            <option value="b2b">Business to Business</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </section>
                    <section class="mb-3">
                        <label class="mb-2" for="selection">Select a selection-operator</label>
                        <select class="form-control" id="selection">
                            <option value="true">Sequential Selection</option>
                            <option value="false" selected>Top 2 Selection (Recommended)</option>
                        </select>
                    </section>
                    <section class="mb-3">
                        <label class="mb-2" for="refresh">Select a step-operator</label>
                        <select class="form-control" id="refresh">
                            <option value="true">Random Restart (Please set the random ratio)</option>
                            <option value="false" selected>Normal (Recommended)</option>
                        </select>
                    </section>
                    <section class="mb-3">
                        <label class="control-label" for="random">Random Ratio <span class="badge bg-secondary" id="randomLabel">0</span></label>
                        <input class="form-range" type="range" min="0" max="1" step="0.01" id="random">
                    </section>
                    <section class="mb-3">
                        <label class="mb-2" for="crossover">Select a crossover-operator</label>
                        <select class="form-control" id="crossover">
                            <option value="true" selected>True (Recommended)</option>
                            <option value="false">False</option>
                        </select>
                    </section>
                    <section class="mb-3">
                        <label class="mb-2" for="mutation">Select a mutation-operator</label>
                        <select class="form-control" id="mutation">
                            <option value="flip">Flip</option>
                            <option value="value" selected>Value (Recommended)</option>
                            <option value="swap">Swap</option>
                            <option value="reverse">Reverse</option>
                        </select>
                    </section>
                    <section class="mb-3">
                        <label class="control-label" for="pop">Population <span class="badge bg-secondary" id="popLabel">500</span></label>
                        <input class="form-range" type="range" min="5" max="40" id="pop">
                    </section>
                    <section class="mb-3">
                        <label class="control-label" for="gen">Generations <span class="badge bg-secondary" id="genLabel">500</span></label>
                        <input class="form-range" type="range" min="0" max="1000" id="gen">
                    </section>
                    <section class="mb-3 row">
                        <div class="col-12 d-flex justify-content-end">
                            <div class="d-flex justify-content-center align-items-center btn btn-primary" onclick="parse()">Generate</div>
                        </div>
                    </section>
                </form>
            </article>
            <article class="col-12 col-lg-6 pe-lg-0">
                <form class="test">
                    <section class="test">
                        <h2 class="test" id="1">Hello!</h2>
                    </section>
                    <section class="test">
                        <label class="test form-label" id="3">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</label><br>
                    </section>
                    <section class="test">
                        <textarea class="test w-100 form-control" rows="3" placeholder="Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua." maxlength="120" id="4"></textarea>
                        <label for=4 class="test">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</label>
                    </section>
                    <section class="test">
                        <input class="test w-100 form-control" placeholder="Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua." id="5" maxlength="30">
                        <label for=5 class="test">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</label>
                    </section>
                    <section class="test">
                        <input class="test w-100 form-control" type="date" id="8">
                        <label for=8 class="test">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</label>
                    </section>
                    <section class="test">
                        <input class="test w-100 form-control" type="time" id="9">
                        <label for=9 class="test">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.</label>
                    </section>
                    <section class="test">
                        <input class="test" type="checkbox" id="2">
                        <label for=2 class="test">I am a checkbox</label>
                    </section>
                    <section class="test">
                        <button class="test btn" id="6">Submit</button>
                    </section>
                </form>
            </article>
            <article class="col-12 mt-3 p-3 p-lg-0">
                <form class="border border-1 p-2 p-lg-4 m-0">
                    <section class="col-12 d-flex justify-content-evenly p-0">
                        <label class="control-label">Avg Fitness <span class="badge bg-secondary" id="fitLabel">0</span></label>
                        <label class="control-label">Avg Runtime <span class="badge bg-secondary" id="durLabel">0</span></label>
                    </section>
                    <section class="col-12 p-0">
                        <div id="plot_fitness"></div>
                        <div id="plot_duration"></div>
                    </section>
                </form>
            </article>
        </section>
    </section>
</body>
</html>